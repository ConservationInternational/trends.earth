name: Push to transifex

on:
  schedule:
    - cron: "0 4 * * *"
  workflow_dispatch:

jobs:
  transifex_push:
    name: Push latest strings to transifex
    runs-on: ubuntu-latest
    env:
      TX_TOKEN: ${{ secrets.TX_TOKEN }}
      AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION }}
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
      - name: Setup python
        uses: actions/setup-python@v3
        with:
          python-version: "3.9"
          architecture: "x64"
          cache: pip
      - run: pip install -r requirements-dev.txt
      - name: Install transifex CLI
        run: curl -o- https://raw.githubusercontent.com/transifex/cli/master/install.sh | bash
      - name: Push strings to transifex
        run: invoke translate-push
